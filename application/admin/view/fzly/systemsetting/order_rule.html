{extend name="common/base" /}
{block name="content"}
<div class="layui-card">
    <div class="layui-card-header">
        <h3 class="layui-card-title">订单规则配置</h3>
        <div class="layui-btn-group layui-card-header-toolbar">
            <button class="layui-btn layui-btn-normal" id="saveBtn"><i class="fa fa-save"></i> 保存配置</button>
        </div>
    </div>
    <div class="layui-card-body">
        <form class="layui-form" id="orderRuleForm">
            <div class="layui-form-item">
                <label class="layui-form-label required">支付超时时间</label>
                <div class="layui-input-block">
                    <input type="number" name="pay_timeout"
                           value="{$orderRule.pay_timeout|default=30}"
                           class="layui-input"
                           lay-verify="required|number|min:5|max:120"
                           placeholder="请输入5-120分钟之间的整数">
                    <p class="layui-form-mid layui-word-aux">订单创建后多少分钟内未支付将自动取消</p>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label required">库存释放间隔</label>
                <div class="layui-input-block">
                    <input type="number" name="stock_release_interval"
                           value="{$orderRule.stock_release_interval|default=5}"
                           class="layui-input"
                           lay-verify="required|number|min:1|max:30"
                           placeholder="请输入1-30分钟之间的整数">
                    <p class="layui-form-mid layui-word-aux">订单取消后多少分钟内释放库存</p>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label required">状态</label>
                <div class="layui-input-block">
                    <input type="radio" name="status" value="1" title="启用"
                           {if $orderRule.status == 1}checked{/if}>
                    <input type="radio" name="status" value="0" title="禁用"
                           {if $orderRule.status == 0}checked{/if}>
                </div>
            </div>
        </form>
    </div>
</div>
{/block}

{block name="script"}
<script>
    layui.use(['form', 'layer'], function(){
        var form = layui.form,
            layer = layui.layer;

        // 保存配置
        $('#saveBtn').click(function(){
            form.validate(function(valid){
                if(valid){
                    $.ajax({
                        url: '{:url("systemsetting/systemsetting/order_rule")}',
                        type: 'post',
                        data: $('#orderRuleForm').serialize(),
                        success: function(res){
                            if(res.code == 1){
                                layer.msg(res.msg, {icon:1});
                            }else{
                                layer.msg(res.msg, {icon:2});
                            }
                        }
                    });
                }
            });
        });
    });
</script>
{/block}